database_source: mzp
dataset_name: mzp
table_name: solicitation
hwm_column: last_upd_dt
split_by_column: to_number(to_char(last_upd_dt ,'"'"'yyyymmddhh24miss'"'"'))
num_mappers: 6
target_dir: gs://adw-lake-mzp-{ENV}/solicitation/source/{{{{ ds }}}}

query: >-
    select
    solicitation_ky,
    solicitation_cd,
    begin_dt,
    source_of_sale,
    end_dt,
    billing_category_cd,
    comments,
    last_upd_dt,
    unit_ct,
    cost_at,
    primary_ct,
    associate_ct,
    active_fl,
    incentive_cd,
    extra_months,
    web_include_fl,
    auto_renewal_fl,
    auto_renewal_required_fl,
    auto_renewal_discount_at,
    billing_category_cd_ar_exist,
    billing_category_cd_bill,
    billing_category_cd_2,
    billing_category_cd_3,
    billing_category_cd_4,
    billing_category_cd_5,
    billing_category_cd_6,
    billing_category_cd_7,
    billing_category_cd_8,
    billing_category_cd_9,
    billing_category_cd_10,
    billing_category_cd_11,
    billing_category_cd_12,
    billing_category_cd_13,
    billing_category_cd_ar_new,
    group_cd,
    membership_type_cd,
    campaign_cd,
    solicitation_category_cd,
    vendor_ky,
    temporary_membership_duration,
    REPLACE(REPLACE(REPLACE(offer_text, CHR(10)), CHR(13)), CHR(124)) AS offer_text,
    auto_renewal_text,
    free_assoc_with_autorenew_fl,
    billing_split_cd,
    coverage_level_ky,
    SYSDATE as adw_lake_insert_datetime,
    {{{{ dag_run.id }}}} as adw_lake_insert_batch_number
    from mz_plus_212.mz_solicitation
    where $CONDITIONS
    
ddl: >-
  CREATE TABLE IF NOT EXISTS `{INGESTION_PROJECT}.mzp.solicitation` (
  SOLICITATION_KY                  STRING          NOT NULL,
   SOLICITATION_CD                  STRING,
   SOLIC_BEGIN_DT                   STRING,
   SOURCE_OF_SALE                   STRING,
   SOLIC_END_DT                     STRING,
   BILLING_CATEGORY_CD              STRING,
   COMMENTS                         STRING,
   LAST_UPD_DT                      STRING,
   UNIT_CT                          STRING,
   COST_AT                          STRING,
   PRIMARY_CT                       STRING,
   ASSOCIATE_CT                     STRING,
   ACTIVE_FL                        STRING,
   INCENTIVE_CD                     STRING,
   EXTRA_MONTHS                     STRING,
   WEB_INCLUDE_FL                   STRING,
   AUTO_RENEWAL_FL                  STRING,
   AUTO_RENEWAL_REQUIRED_FL         STRING,
   AUTO_RENEWAL_DISCOUNT_AT         STRING,
   BILLING_CATEGORY_CD_AR_EXIST     STRING,
   BILLING_CATEGORY_CD_BILL         STRING,
   BILLING_CATEGORY_CD_2            STRING,
   BILLING_CATEGORY_CD_3            STRING,
   BILLING_CATEGORY_CD_4            STRING,
   BILLING_CATEGORY_CD_5            STRING,
   BILLING_CATEGORY_CD_6            STRING,
   BILLING_CATEGORY_CD_7            STRING,
   BILLING_CATEGORY_CD_8            STRING,
   BILLING_CATEGORY_CD_9            STRING,
   BILLING_CATEGORY_CD_10           STRING,
   BILLING_CATEGORY_CD_11           STRING,
   BILLING_CATEGORY_CD_12           STRING,
   BILLING_CATEGORY_CD_13           STRING,
   BILLING_CATEGORY_CD_AR_NEW       STRING,
   GROUP_CD                         STRING,
   MEMBERSHIP_TYPE_CD               STRING,
   CAMPAIGN_CD                      STRING,
   SOLICITATION_CATEGORY_CD         STRING,
   VENDOR_KY                        STRING,
   TEMPORARY_MEMBERSHIP_DURATION    STRING,
   OFFER_TEXT                       STRING,
   AUTO_RENEWAL_TEXT                STRING,
   FREE_ASSOC_WITH_AUTORENEW_FL     STRING,
   BILLING_SPLIT_CD                 STRING,
   COVERAGE_LEVEL_KEY               STRING,
   adw_lake_insert_datetime        DATETIME,
   adw_lake_insert_batch_number    INT64)
  PARTITION BY DATE(_PARTITIONTIME)
  ;


database_source: epic
dataset_name: epic
table_name: employee
hwm_column: updateddate
split_by_column: updateddate
num_mappers: 6
target_dir: gs://adw-lake-epic-{ENV}/employee/source/{{{{ ds }}}}

query: >-
  select * from (
  select
      uniqentity                              ,
      lookupcode                               ,
      nameof                                  ,
      uniqcontactnameaccount                  ,
      uniqcontactaddressaccount               ,
      uniqcontactnumberresidenceaccount       ,
      uniqcontactnumbermobileaccount          ,
      uniqcontactnumberfaxaccount             ,
      uniqcontactnumberemailaccount           ,
      department                           ,
      jobtitle                             ,
      uniqdocumentsignature                   ,
      REPLACE(REPLACE(REPLACE(comments, CHAR(10), CHAR(32)), CHAR(13), CHAR(32)), CHAR(124), CHAR(32)) as comments,
      batchpaymentmethodcode                   ,
      uniqglaccountpay                        ,
      uniqglaccountdef                        ,
      uniqglaccountexp                        ,
      uniqglaccountabill                      ,
      uniqglaccountdbill                      ,
      emergencycontactname1                ,
      emergencycontactnumber1                 ,
      emergencycontactextension1              ,
      emergencycontactdescription1         ,
      emergencycontactemail1                  ,
      emergencycontactname2                ,
      emergencycontactnumber2                 ,
      emergencycontactextension2              ,
      emergencycontactdescription2         ,
      emergencycontactemail2                  ,
      hireddate                            ,
      fullparttimecode                         ,
      numberhours                          ,
      lastreviewdate                       ,
      nextreviewdate                       ,
      lastraisedate                        ,
      terminateddate                       ,
      compensationtypecode                     ,
      yearlysalary                         ,
      hourlywage                           ,
      inactivedate                         ,
      inactivereason                          ,
      expirationdate                       ,
      conversiondate                       ,
      conversionprioraccountid             ,
      insertedbycode                          ,
      inserteddate                            ,
      updatedbycode                           ,
      coalesce(updateddate,ts,inserteddate) as updateddate                          ,
      roleflags                               ,
      flags                                   ,
      ts                                          ,
      inactivatedbycode                       ,
      emergencycontactphonecountrycode1       ,
      emergencycontactphonecountrycode2       ,
      uniqglaccountpaywriteoff                ,
      uniqcontactnumberbusinessaccount        ,
      uniqcontactnumberemailaccount2          ,
      uniqsmsnumber                           ,
      employeeid                              ,
      CURRENT_TIMESTAMP as adw_lake_insert_datetime,
      {{{{ dag_run.id }}}} as adw_lake_insert_batch_number
  from [{db_name}].dbo.employee) a
  where $CONDITIONS


ddl: >-
  CREATE TABLE IF NOT EXISTS `{INGESTION_PROJECT}.epic.employee`
  ( uniqentity                           string   ,
    lookupcode                           string    ,
    nameof                               string   ,
    uniqcontactnameaccount               string   ,
    uniqcontactaddressaccount            string   ,
    uniqcontactnumberresidenceaccount    string   ,
    uniqcontactnumbermobileaccount       string   ,
    uniqcontactnumberfaxaccount          string   ,
    uniqcontactnumberemailaccount        string   ,
    department                           string,
    jobtitle                             string,
    uniqdocumentsignature                string   ,
    comments                             string   ,
    batchpaymentmethodcode               string    ,
    uniqglaccountpay                     string   ,
    uniqglaccountdef                     string   ,
    uniqglaccountexp                     string   ,
    uniqglaccountabill                   string   ,
    uniqglaccountdbill                   string   ,
    emergencycontactname1                string,
    emergencycontactnumber1              string   ,
    emergencycontactextension1           string   ,
    emergencycontactdescription1         string,
    emergencycontactemail1               string   ,
    emergencycontactname2                string,
    emergencycontactnumber2              string   ,
    emergencycontactextension2           string   ,
    emergencycontactdescription2         string,
    emergencycontactemail2               string   ,
    hireddate                            string,
    fullparttimecode                     string    ,
    numberhours                          string,
    lastreviewdate                       string,
    nextreviewdate                       string,
    lastraisedate                        string,
    terminateddate                       string,
    compensationtypecode                 string    ,
    yearlysalary                         string,
    hourlywage                           string,
    inactivedate                         string,
    inactivereason                       string   ,
    expirationdate                       string,
    conversiondate                       string,
    conversionprioraccountid             string,
    insertedbycode                       string   ,
    inserteddate                         string   ,
    updatedbycode                        string   ,
    updateddate                          string,
    roleflags                            string   ,
    flags                                string   ,
    ts                                   string       ,
    inactivatedbycode                    string   ,
    emergencycontactphonecountrycode1    string   ,
    emergencycontactphonecountrycode2    string   ,
    uniqglaccountpaywriteoff             string   ,
    uniqcontactnumberbusinessaccount     string   ,
    uniqcontactnumberemailaccount2       string   ,
    uniqsmsnumber                        string   ,
    employeeid                           string   ,
    adw_lake_insert_datetime             datetime       ,
    adw_lake_insert_batch_number         int64   
  )
  PARTITION BY DATE(_PARTITIONTIME);
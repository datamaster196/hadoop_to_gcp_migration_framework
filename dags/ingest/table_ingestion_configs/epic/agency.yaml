database_source: epic
dataset_name: epic
table_name: agency 
hwm_column: 
split_by_column: UpdatedDate 
num_mappers: 1
target_dir: gs://adw-lake-epic-{ENV}/agency/source/{{{{ ds }}}}

query: >-
  select
      UniqAgency,
      AgencyCode,
      NameOf,
      LicenseNumber,
      IssuerKey,
      PIN,
      UniqRegion,
      InitialMonth,
      FirstFiscalMonth,
      FEIN,
      MaxAccountReceivableWriteOff,
      MaxCompanyPayableWriteOff,
      UniqGLAccountinterReceivables,
      UniqGLAccountinterPayables,
      InsertedByCode,
      InsertedDate,
      UpdatedByCode,
      UpdatedDate,
      Flags,
      UniqGLAccountinteragencyCommissionPayables,
      UniqGLAccountinteragencyDeferredCommissionPayables,
      UniqGLAccountinteragencyCommissionReceivables,
      UniqGLAccountinteragencyDeferredCommissionReceivables,
      UniqGLAccountinteragencyCommissionIncome,
      UniqGLAccountinteragencyBrokerPremiumPayables,
      UniqGLAccountinteragencyBrokerPremiumReceivables,
      MaxBrokerPremiumPayableWriteoff,
      MaxProducerCommissionWriteOff,
      MaxBrokerCommissionWriteOff,
      UniqGLAccountinteragencyCommissionPayableWriteOff,
      UniqGLAccountinteragencyCommissionExpense,
      NYLicenseNumber,
      UniqGLAccountinteragencyBrokerPremiumPayableWriteOff,
      UniqGLAccountinteragencyDeferredBrokerPremiumPayables,
      UniqMainAddress,
      UniqMailingAddress,
      UniqOrganizationPhone,
      UniqOrganizationFax,
      UniqOrganizationEmail,
      UniqOrganizationWebsite,
      UniqOtherAddress,
      UniqOrganizationSMS,
      AgencyID,
      ShortName,
      CURRENT_TIMESTAMP as adw_lake_insert_datetime,
      {{{{ dag_run.id }}}} as adw_lake_insert_batch_number
  from [{db_name}].dbo.agency
  where $CONDITIONS


ddl: >-
  CREATE TABLE IF NOT EXISTS `{INGESTION_PROJECT}.epic.agency`
  ( UniqAgency                                               String,
    AgencyCode                                               String,
    NameOf                                                   String,
    LicenseNumber                                            String,
    IssuerKey                                                String,
    PIN                                                      String,
    UniqRegion                                               String,
    InitialMonth                                             String,
    FirstFiscalMonth                                         String,
    FEIN                                                     String,
    MaxAccountReceivableWriteOff                             String,
    MaxCompanyPayableWriteOff                                String,
    UniqGLAccountinterReceivables                            String,
    UniqGLAccountinterPayables                               String,
    InsertedByCode                                           String,
    InsertedDate                                             String,
    UpdatedByCode                                            String,
    UpdatedDate                                              String,
    Flags                                                    String,
    UniqGLAccountinteragencyCommissionPayables               String,
    UniqGLAccountinteragencyDeferredCommissionPayables       String,
    UniqGLAccountinteragencyCommissionReceivables            String,
    UniqGLAccountinteragencyDeferredCommissionReceivables    String,
    UniqGLAccountinteragencyCommissionIncome                 String,
    UniqGLAccountinteragencyBrokerPremiumPayables            String,
    UniqGLAccountinteragencyBrokerPremiumReceivables         String,
    MaxBrokerPremiumPayableWriteoff                          String,
    MaxProducerCommissionWriteOff                            String,
    MaxBrokerCommissionWriteOff                              String,
    UniqGLAccountinteragencyCommissionPayableWriteOff        String,
    UniqGLAccountinteragencyCommissionExpense                String,
    NYLicenseNumber                                          String,
    UniqGLAccountinteragencyBrokerPremiumPayableWriteOff     String,
    UniqGLAccountinteragencyDeferredBrokerPremiumPayables    String,
    UniqMainAddress                                          String,
    UniqMailingAddress                                       String,
    UniqOrganizationPhone                                    String,
    UniqOrganizationFax                                      String,
    UniqOrganizationEmail                                    String,
    UniqOrganizationWebsite                                  String,
    UniqOtherAddress                                         String,
    UniqOrganizationSMS                                      String,
    AgencyID                                                 String,
    ShortName                                                String,
    adw_lake_insert_datetime        datetime    ,
    adw_lake_insert_batch_number    int64)
  PARTITION BY DATE(_PARTITIONTIME); 
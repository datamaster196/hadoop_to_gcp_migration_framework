database_source: d3cur
dataset_name: d3cur
table_name: service_call
hwm_column: status_upd_tm
split_by_column:
num_mappers: 1
target_dir: gs://adw-lake-d3cur-{ENV}/service_call/source/{{{{ ds }}}}

query: >-
  select
    sc_facltrk,
    trunc(sc_dt) as sc_dt,
    sc_id,
    sc_call_clb_cd,
    sc_call_id_da,
    sc_csh_rqr_in,
    REPLACE(REPLACE(REPLACE(sc_cntc_fst_nm, CHR(10)), CHR(13)), CHR(124)) AS sc_cntc_fst_nm,
    REPLACE(REPLACE(REPLACE(sc_cntc_lst_nm, CHR(10)), CHR(13)), CHR(124)) AS sc_cntc_lst_nm,
    sc_cntc_suffix,
    sc_prty_cd,
    sc_wait_tm,
    sc_prms_arr_tm,
    sc_red_flag_in,
    cb_flag,
    hist_flag,
    sc_policy,
    sc_src_cd,
    sc_asgn_seq_id,
    svc_veh_seq_id,
    bl_seq_id,
    tow_seq_id,
    hold_for_callbk,
    status_cd,
    status_upd_tm,
    sc_rcvd_tm,
    cb_member,
    cb_req_min,
    last_update,
    sc_sc_unseen_chng,
    sc_unseen_chng,
    in_eod_fl,
    calr_id,
    emple_id,
    apd_seq_id,
    salutation,
    init_callback,
    mbr_callback,
    eds_indic,
    chg_emple_id,
    sc_trc_flag,
    sc_td_type,
    accident_assist_flag,
    public_flag,
    SYSDATE as adw_lake_insert_datetime,
    {{{{ dag_run.id }}}} as adw_lake_insert_batch_number
  from aca_cad.service_call
  where $CONDITIONS

ddl: >-
  CREATE TABLE IF NOT EXISTS `{INGESTION_PROJECT}.d3cur.service_call` (
    sc_facltrk           STRING,
    sc_dt                STRING NOT NULL,
    sc_id                STRING NOT NULL,
    sc_call_clb_cd       STRING,
    sc_call_id_da        STRING,
    sc_csh_rqr_in        STRING,
    sc_cntc_fst_nm       STRING,
    sc_cntc_lst_nm       STRING,
    sc_cntc_suffix       STRING,
    sc_prty_cd           STRING,
    sc_wait_tm           STRING,
    sc_prms_arr_tm       STRING,
    sc_red_flag_in       STRING,
    cb_flag              STRING,
    hist_flag            STRING,
    sc_policy            STRING,
    sc_src_cd            STRING,
    sc_asgn_seq_id       STRING,
    svc_veh_seq_id       STRING,
    bl_seq_id            STRING,
    tow_seq_id           STRING,
    hold_for_callbk      STRING,
    status_cd            STRING,
    status_upd_tm        STRING,
    sc_rcvd_tm           STRING,
    cb_member            STRING,
    cb_req_min           STRING,
    last_update          STRING,
    sc_sc_unseen_chng    STRING,
    sc_unseen_chng       STRING,
    in_eod_fl            STRING,
    calr_id              STRING,
    emple_id             STRING,
    apd_seq_id           STRING,
    salutation           STRING,
    init_callback        STRING,
    mbr_callback         STRING,
    eds_indic            STRING,
    chg_emple_id         STRING,
    sc_trc_flag          STRING,
    sc_td_type           STRING,
    accident_assist_flag STRING,
    public_flag          STRING,
    adw_lake_insert_datetime		DATETIME,
    adw_lake_insert_batch_number	INT64
    )
    PARTITION BY DATE(_PARTITIONTIME);
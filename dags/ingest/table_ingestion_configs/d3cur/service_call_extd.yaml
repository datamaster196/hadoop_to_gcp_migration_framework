database_source: d3cur
dataset_name: d3cur
table_name: service_call_extd
hwm_column: status_upd_tm
split_by_column:
num_mappers: 1
target_dir: gs://adw-lake-d3cur-{ENV}/service_call_extd/source/{{{{ ds }}}}

query: >-
  select *
  from
    (select
      trunc(e.sc_dt) as sc_dt,
      e.sc_id,
      e.eds_indic,
      e.scoc_indic,
      e.cuc_indic,
      e.flatbed_req_indic,
      e.use_this_facl,
      e.not_this_facl,
      e.bill_code,
      e.apt_call_indic,
      e.eds_clear_status,
      e.eds_msg_control,
      e.mbr_addr_changed,
      e.cash_call_type,
      e.po_tracking_number,
      e.spot_method,
      e.spot_refnum1,
      e.spot_refnum2,
      e.spot_county,
      e.check_digit,
      e.num_passengers,
      e.call_type,
      e.rv_class,
      e.response_indic,
      e.call_move_status,
      e.call_move_dest,
      e.call_move_dest_q,
      e.call_move_club_cd,
      e.call_mv_tcode_xlat,
      e.auth_cd,
      e.auth_level,
      REPLACE(REPLACE(REPLACE(e.email_addr, CHR(10)), CHR(13)), CHR(124)) AS email_addr,
      e.batt_svc_result,
      e.battery_tested,
      e.battery_testnumber,
      e.mbr_req_email,
      e.long_tow_elig_indic,
      e.long_tow_miles_allow,
      e.collision_flag,
      e.language,
      e.cc_info_flg,
      e.cc_rcpt_flg,
      e.cc_chrg_flg,
      e.cc_amt,
      e.remote_chg_eta,
      e.callmv_indic,
      e.eta_callback_req,
      e.auto_callout_count,
      e.last_callback_time,
      e.last_callback_status,
      e.avl_eta,
      e.sms_opt_in,
      e.email_opt_in,
      e.sms_contact_mbr,
      e.sms_mbr_no_ack,
      e.sc_tlc_prob1_cd_orig,
      e.sc_tlc_prob2_cd_orig,
      e.special_equip_cd,
      e.delivery_confirmation_code,
      e.is_close_pending_flag,
      e.inventory_missing,
      e.sale_id,
      e.d3_callback_state,
      e.tow_indic,
      e.urgent_comment_indic,
      e.nexus_impacted,
      a.status_upd_tm,
      SYSDATE as adw_lake_insert_datetime,
      {{{{ dag_run.id }}}} as adw_lake_insert_batch_number
    from aca_cad.service_call_extd e
    inner join aca_cad.service_call a on a.sc_dt = e.sc_dt and a.sc_id = e.sc_id
  ) t
  where $CONDITIONS

ddl: >-
  CREATE TABLE IF NOT EXISTS `{INGESTION_PROJECT}.d3cur.service_call_extd` (
    sc_dt                      STRING NOT NULL,
    sc_id                      STRING NOT NULL,
    eds_indic                  STRING,
    scoc_indic                 STRING,
    cuc_indic                  STRING,
    flatbed_req_indic          STRING,
    use_this_facl              STRING,
    not_this_facl              STRING,
    bill_code                  STRING,
    apt_call_indic             STRING,
    eds_clear_status           STRING,
    eds_msg_control            STRING,
    mbr_addr_changed           STRING,
    cash_call_type             STRING,
    po_tracking_number         STRING,
    spot_method                STRING,
    spot_refnum1               STRING,
    spot_refnum2               STRING,
    spot_county                STRING,
    check_digit                STRING,
    num_passengers             STRING,
    call_type                  STRING,
    rv_class                   STRING,
    response_indic             STRING,
    call_move_status           STRING,
    call_move_dest             STRING,
    call_move_dest_q           STRING,
    call_move_club_cd          STRING,
    call_mv_tcode_xlat         STRING,
    auth_cd                    STRING,
    auth_level                 STRING,
    email_addr                 STRING,
    batt_svc_result            STRING,
    battery_tested             STRING,
    battery_testnumber         STRING,
    mbr_req_email              STRING,
    long_tow_elig_indic        STRING,
    long_tow_miles_allow       STRING,
    collision_flag             STRING,
    language                   STRING,
    cc_info_flg                STRING,
    cc_rcpt_flg                STRING,
    cc_chrg_flg                STRING,
    cc_amt                     STRING,
    remote_chg_eta             STRING,
    callmv_indic               STRING,
    eta_callback_req           STRING,
    auto_callout_count         STRING,
    last_callback_time         STRING,
    last_callback_status       STRING,
    avl_eta                    STRING,
    sms_opt_in                 STRING,
    email_opt_in               STRING,
    sms_contact_mbr            STRING,
    sms_mbr_no_ack             STRING,
    sc_tlc_prob1_cd_orig       STRING,
    sc_tlc_prob2_cd_orig       STRING,
    special_equip_cd           STRING,
    delivery_confirmation_code STRING,
    is_close_pending_flag      STRING,
    inventory_missing          STRING,
    sale_id                    STRING,
    d3_callback_state          STRING,
    tow_indic                  STRING,
    urgent_comment_indic       STRING,
    nexus_impacted             STRING,
    status_upd_tm              STRING,
    adw_lake_insert_datetime		DATETIME,
    adw_lake_insert_batch_number	INT64
    )
    PARTITION BY DATE(_PARTITIONTIME);
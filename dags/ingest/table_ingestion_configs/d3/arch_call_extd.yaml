database_source: d3
dataset_name: d3
table_name: arch_call_extd
hwm_column: sc_dt
split_by_column: to_number(to_char(sc_dt ,'"'"'yyyymmddhh24miss'"'"'))
num_mappers: 6
target_dir: gs://adw-lake-d3-{ENV}/arch_call_extd/source/{{{{ ds }}}}

query: >-
  SELECT
    comm_ctr_id,
    sc_dt,
    sc_id,
    eds_indic,
    scoc_indic,
    cuc_indic,
    REPLACE(REPLACE(REPLACE(flatbed_req_indic, CHR(10)), CHR(13)), CHR(124)) as flatbed_req_indic,
    REPLACE(REPLACE(REPLACE(use_this_facl, CHR(10)), CHR(13)), CHR(124)) as use_this_facl,
    REPLACE(REPLACE(REPLACE(not_this_facl, CHR(10)), CHR(13)), CHR(124)) as not_this_facl,
    REPLACE(REPLACE(REPLACE(bill_code, CHR(10)), CHR(13)), CHR(124)) as bill_code,
    apt_call_indic,
    trk_zone,
    bl_lat,
    bl_long,
    td_lat,
    td_long,
    driver_name,
    tow_dest_id,
    flatbed_indic,
    four_wheel_drive,
    rec_vehicle,
    awd_vehicle,
    cash_call_type,
    po_tracking_number,
    cc_number,
    cc_expire_date,
    district_num,
    facl_onloc_chk_dgt,
    num_passengers,
    call_type,
    rv_class,
    mcycle_indic,
    svc_facl_id,
    svc_tick_approvd,
    accounting_date,
    response_indic,
    REPLACE(REPLACE(REPLACE(auth_cd, CHR(10)), CHR(13)), CHR(124)) as auth_cd,
    auth_level,
    REPLACE(REPLACE(REPLACE(email_addr, CHR(10)), CHR(13)), CHR(124)) as email_addr,
    bl_tel_typ_cd,
    miles_start_orig,
    miles_onlc_orig,
    miles_dest_orig,
    audit_flag,
    mbr_req_email,
    auditor,
    cc_info_flg,
    cc_rcpt_flg,
    cc_chrg_flg,
    cc_amt,
    used_long_tow,
    long_tow_elig_indic,
    long_tow_miles_allow,
    bl_n_lndmrk_tx,
    language,
    collision_flag,
    batt_svc_result,
    battery_tested,
    REPLACE(REPLACE(REPLACE(battery_testnumber, CHR(10)), CHR(13)), CHR(124)) as battery_testnumber,
    battery_test_results,
    battery_part_number,
    battery_price,
    callmv_indic,
    vehicle_id,
    cc_chrg_revok_flg,
    base_vehicle_id,
    avl_eta,
    sms_opt_in,
    blend_rate_indic,
    dtl_prob1_cd_orig,
    dtl_prob2_cd_orig,
    workflow,two_wheel_drive,
    dolly_indic,
    locksmith_indic,
    wheel_lift_req_indic,
    wheel_lift_indic,
    mc_type,
    mc_eng_type,
    mc_comment,
    mc_pulling_trl,
    mc_laid_down,
    mc_wheels_roll,
    rv_length,
    rv_height,
    rv_gooseneck,
    rv_eng_loc,
    rv_towing,
    rv_type_towing,
    flat_location,
    trl_indic,
    trl_type,
    trl_length,
    trl_no_axles,
    trl_condition,
    trl_plug_type,
    trl_hitch_type,
    trl_hitch_size,
    trl_gooseneck,
    trl_loaded,
    trl_load_type,
    trl_load_weight,
    hybrid_vehicle,
    electric_vehicle,
    is_diesel,
    air_suspension,
    rv_weight,
    passenger_notes,
    REPLACE(REPLACE(REPLACE(priority_comment, CHR(10)), CHR(13)), CHR(124)) as priority_comment,
    key_location,
    d3_callback_state,
    addr2_purpose,
    addr2_block,
    addr2_street,
    addr2_city,
    addr2_state_cd,
    addr2_zip,
    addr2_zip4,
    addr2_county,
    addr2_country,
    addr2_highway_call,
    addr2_mile_marker,
    addr2_callbox,
    addr2_location_cd,
    REPLACE(REPLACE(REPLACE(addr2_landmark, CHR(10)), CHR(13)), CHR(124)) as addr2_landmark,
    REPLACE(REPLACE(REPLACE(addr2_pickup_point, CHR(10)), CHR(13)), CHR(124)) as addr2_pickup_point,
    REPLACE(REPLACE(REPLACE(sc_veh_trm, CHR(10)), CHR(13)), CHR(124)) as sc_veh_trm,
    REPLACE(REPLACE(REPLACE(special_equip_cd, CHR(10)), CHR(13)), CHR(124)) as special_equip_cd,
    REPLACE(REPLACE(REPLACE(delivery_confirmation_code, CHR(10)), CHR(13)), CHR(124)) as delivery_confirmation_code,
    REPLACE(REPLACE(REPLACE(sale_id, CHR(10)), CHR(13)), CHR(124)) as sale_id,
    REPLACE(REPLACE(REPLACE(odometer_reading, CHR(10)), CHR(13)), CHR(124)) as odometer_reading,
    REPLACE(REPLACE(REPLACE(miscellaneous_comment, CHR(10)), CHR(13)), CHR(124)) as miscellaneous_comment,
    inventory_missing,
    tow_indic,
    urgent_comment_indic,
    SYSDATE as adw_lake_insert_datetime,
    {{{{ dag_run.id }}}} as adw_lake_insert_batch_number
  FROM
    aca_ers_hist.arch_call_extd
  WHERE
    $CONDITIONS

ddl: >-
  CREATE TABLE IF NOT EXISTS `{INGESTION_PROJECT}.d3.arch_call_extd` (
        comm_ctr_id                STRING,
        sc_dt                	STRING,
        sc_id                	STRING,
        eds_indic                STRING,
        scoc_indic                STRING,
        cuc_indic                STRING,
        flatbed_req_indic        STRING,
        use_this_facl        	STRING,
        not_this_facl        	STRING,
        bill_code                STRING,
        apt_call_indic        	STRING,
        trk_zone                STRING,
        bl_lat                	STRING,
        bl_long                	STRING,
        td_lat                	STRING,
        td_long                	STRING,
        driver_name                STRING,
        tow_dest_id                STRING,
        flatbed_indic        	STRING,
        four_wheel_drive        STRING,
        rec_vehicle                STRING,
        awd_vehicle                STRING,
        cash_call_type        	STRING,
        po_tracking_number        STRING,
        cc_number                STRING,
        cc_expire_date        	STRING,
        district_num        	STRING,
        facl_onloc_chk_dgt        STRING,
        num_passengers        	STRING,
        call_type                STRING,
        rv_class                STRING,
        mcycle_indic        	STRING,
        svc_facl_id                STRING,
        svc_tick_approvd        STRING,
        accounting_date        	STRING,
        response_indic        	STRING,
        auth_cd                	STRING,
        auth_level                STRING,
        email_addr                STRING,
        bl_tel_typ_cd        	STRING,
        miles_start_orig        STRING,
        miles_onlc_orig        	STRING,
        miles_dest_orig        	STRING,
        audit_flag                STRING,
        mbr_req_email        	STRING,
        auditor                	STRING,
        cc_info_flg                STRING,
        cc_rcpt_flg                STRING,
        cc_chrg_flg                STRING,
        cc_amt                	STRING,
        used_long_tow        	STRING,
        long_tow_elig_indic        STRING,
        long_tow_miles_allow	STRING,
        bl_n_lndmrk_tx        	STRING,
        language                STRING,
        collision_flag        	STRING,
        batt_svc_result        	STRING,
        battery_tested        	STRING,
        battery_testnumber        STRING,
        battery_test_results	STRING,
        battery_part_number        STRING,
        battery_price        	STRING,
        callmv_indic        	STRING,
        vehicle_id                STRING,
        cc_chrg_revok_flg        STRING,
        base_vehicle_id        	STRING,
        avl_eta                	STRING,
        sms_opt_in                STRING,
        blend_rate_indic        STRING,
        dtl_prob1_cd_orig        STRING,
        dtl_prob2_cd_orig        STRING,
        workflow            STRING,
        two_wheel_drive	      STRING,
        dolly_indic                        STRING,
        locksmith_indic                	STRING,
        wheel_lift_req_indic        	STRING,
        wheel_lift_indic                STRING,
        mc_type                        	STRING,
        mc_eng_type                        STRING,
        mc_comment                        STRING,
        mc_pulling_trl                	STRING,
        mc_laid_down                	STRING,
        mc_wheels_roll                	STRING,
        rv_length                        STRING,
        rv_height                        STRING,
        rv_gooseneck                	STRING,
        rv_eng_loc                        STRING,
        rv_towing                        STRING,
        rv_type_towing                	STRING,
        flat_location                	STRING,
        trl_indic                        STRING,
        trl_type                        STRING,
        trl_length                        STRING,
        trl_no_axles                	STRING,
        trl_condition                	STRING,
        trl_plug_type                	STRING,
        trl_hitch_type                	STRING,
        trl_hitch_size                	STRING,
        trl_gooseneck                	STRING,
        trl_loaded                        STRING,
        trl_load_type                	STRING,
        trl_load_weight                	STRING,
        hybrid_vehicle                	STRING,
        electric_vehicle                STRING,
        is_diesel                        STRING,
        air_suspension                	STRING,
        rv_weight                        STRING,
        passenger_notes                	STRING,
        priority_comment                STRING,
        key_location                	STRING,
        d3_callback_state                STRING,
        addr2_purpose                	STRING,
        addr2_block                        STRING,
        addr2_street                	STRING,
        addr2_city                        STRING,
        addr2_state_cd                	STRING,
        addr2_zip                        STRING,
        addr2_zip4                        STRING,
        addr2_county                	STRING,
        addr2_country                	STRING,
        addr2_highway_call                STRING,
        addr2_mile_marker                STRING,
        addr2_callbox                	STRING,
        addr2_location_cd                STRING,
        addr2_landmark                	STRING,
        addr2_pickup_point                STRING,
        sc_veh_trm                        STRING,
        special_equip_cd                STRING,
        delivery_confirmation_code        STRING,
        sale_id                        	STRING,
        odometer_reading                STRING,
        miscellaneous_comment        	STRING,
        inventory_missing                STRING,
        tow_indic                        STRING,
        urgent_comment_indic        	STRING,
        adw_lake_insert_datetime        DATETIME,
        adw_lake_insert_batch_number	INT64
    )
    PARTITION BY DATE(_PARTITIONTIME)
    ;
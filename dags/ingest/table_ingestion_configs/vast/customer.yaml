database_source: vast
dataset_name: vast
table_name: customer 
hwm_column: LASTUPDATEDATE
split_by_column: LASTUPDATEDATE
num_mappers: 2
target_dir: gs://adw-lake-vast-{ENV}/customer/source/{{{{ ds }}}}

query: >-
  select
      CUSTOMER_NUMBER,
      SORT,
      case
         when First_Name like '"'"'%%|||'"'"' then CONCAT(substring(First_Name, 1, len(First_Name)-3) , '"'"'3'"'"')
         when First_Name like '"'"'%%||'"'"' then CONCAT(substring(First_Name, 1, len(First_Name)-2) , '"'"'2'"'"')
         when First_Name like '"'"'%%|'"'"' then CONCAT(substring(First_Name, 1, len(First_Name)-1) , '"'"'1'"'"')
      else
             First_Name
      end
      as First_Name,
      LAST_NAME,
      ADDRESS,
      ADDRESS2,
      CITY,
      STATE,
      ZIPCODE,
      DAY_AREA_CODE,
      DAY_THREE,
      DAY_FOUR,
      DAY_EXTENSION,
      NIGHT_AREA_CODE,
      NIGHT_THREE,
      NIGHT_FOUR,
      NIGHT_EXTENSION,
      OTHER_AREA_CODE,
      OTHER_THREE,
      OTHER_FOUR,
      OTHER_EXTENSION,
      TYPE,
      ACCOUNT_STATUS,
      BAL_METHOD,
      STMNT_FREQ,
      CREDIT_LIMIT,
      DISCOUNT,
      TERMS,
      FIN_CHG_FLAG,
      SALES_PTD,
      SALES_YTD,
      ACCOUNT_BAL,
      TAXABLE,
      TAX_EXEMPT_NUMBER,
      DATE_LAST_SALE,
      DATE_LAST_PAID,
      GENDER,
      EMAILADDRESS,
      COMPANY,
      SHOP_NUMBER,
      SPECIAL_INFORMATION,
      PRIOR_RECORD,
      TAX_EXEMPT_REASCODE,
      BILLNAME,
      BILLADDRESS,
      BILLCITY,
      BILLSTATE,
      BILLZIPCODE,
      BILLCOUNTRY,
      CHAIN,
      BILLPHONEAREA,
      BILLPHONETHREE,
      BILLPHONEFOUR,
      BILLCONTACTNAME,
      BILLCONTACTTITLE,
      FLEETPROXYFLAG,
      FLEETCUSTOMERNUMBER,
      CREDIT_LIMIT_TYPE,
      CREDIT_LIMIT_PCT,
      PAYMENT_TERMS,
      SEND_TO_SHOP,
      WEB_CUSTOMER_ID,
      REQUIRED_FIELD_1,
      REQUIRED_FIELD_2,
      LAST_STATEMENT_DATE,
      New_Update,
      FRANCHISE_CUST_NBR,
      FIRST_INVOICE_DATE,
      BUYING_LEVEL,
      RETREAD,
      List_Price,
      GTRACS_CUSTOMER,
      PRINT_OPTION,
      GY_BillTo_NA,
      GY_BillTo_NonSig,
      FAX_AREA_CODE,
      FAX_THREE,
      FAX_FOUR,
      FAX_EXTENSION,
      NON_SIG,
      LEVEL1TAX_EXEMPT_NUMBER,
      LEVEL2TAX_EXEMPT_NUMBER,
      LEVEL3TAX_EXEMPT_NUMBER,
      LEVEL4TAX_EXEMPT_NUMBER,
      LEVEL5TAX_EXEMPT_NUMBER,
      LEVEL6TAX_EXEMPT_NUMBER,
      LEVEL7TAX_EXEMPT_NUMBER,
      LEVEL8TAX_EXEMPT_NUMBER,
      LEVEL9TAX_EXEMPT_NUMBER,
      ISLEVEL1TAXABLE,
      ISLEVEL2TAXABLE,
      ISLEVEL3TAXABLE,
      ISLEVEL4TAXABLE,
      ISLEVEL5TAXABLE,
      ISLEVEL6TAXABLE,
      ISLEVEL7TAXABLE,
      ISLEVEL8TAXABLE,
      ISLEVEL9TAXABLE,
      CREDIT_APP,
      ARTERM_CODE,
      DATE_OPENED,
      SALESMAN,
      COUNTRY,
      LOCAL_TAX_EXEMPT,
      LEGAL_NAME,
      SEND_TO_THIRDPARTY,
      Office_Customer,
      GY_EXEMPT_IND,
      GY_ShipTo_Nonsig,
      CELL_PHONE_CARRIER,
      Tax_Certificate,
      DISALLOW_TAGALONGS,
      REQUIRES_BUYSIDE_PONUM,
      LABOR_RATE,
      TaxDflt,
      PriceClassID,
      CreditRule,
      POReqd,
      TaxID,
      ShipComplete,
      SPCLPGM_CODE,
      CustFillPriority,
      DefaultPaymentType,
      DefaultShipToID,
      ADP_CUSTOMERID,
      LASTUPDATEDATE,
      CUSTID8,
      PRICE_SET_NUMBER,
      CI_TYPE,
      CI_CUSTID,
      PRINT_TYPE,
      DO_NOT_MAIL,
      DO_NOT_EMAIL,
      RETREAD_CUSTOMER_ID,
      ARREGION,
      RETREAD_ORDERTYPE,
      RETREAD_NA_CUSTOMER_NUMBER,
      RETREAD_NA_LOCATION_CODE,
      Member_ID_Number,
      Member_ID_ExpDate,
      Coupon_Sales_YTD,
      New_Customer,
      CURRENT_TIMESTAMP as adw_lake_insert_datetime,
      {{{{ dag_run.id }}}} as adw_lake_insert_batch_number
  from  [{db_name}].dbo.customer
  where $CONDITIONS


ddl: >-
  CREATE TABLE IF NOT EXISTS `{INGESTION_PROJECT}.vast.customer`
    ( CUSTOMER_NUMBER               String,
    SORT                            String,
    FIRST_NAME                      String,
    LAST_NAME                       String,
    ADDRESS                         String,
    ADDRESS2                        String,
    CITY                            String,
    STATE                           String,
    ZIPCODE                         String,
    DAY_AREA_CODE                   String,
    DAY_THREE                       String,
    DAY_FOUR                        String,
    DAY_EXTENSION                   String,
    NIGHT_AREA_CODE                 String,
    NIGHT_THREE                     String,
    NIGHT_FOUR                      String,
    NIGHT_EXTENSION                 String,
    OTHER_AREA_CODE                 String,
    OTHER_THREE                     String,
    OTHER_FOUR                      String,
    OTHER_EXTENSION                 String,
    TYPE                            String,
    ACCOUNT_STATUS                  String,
    BAL_METHOD                      String,
    STMNT_FREQ                      String,
    CREDIT_LIMIT                    String,
    DISCOUNT                        String,
    TERMS                           String,
    FIN_CHG_FLAG                    String,
    SALES_PTD                       String,
    SALES_YTD                       String,
    ACCOUNT_BAL                     String,
    TAXABLE                         String,
    TAX_EXEMPT_NUMBER               String,
    DATE_LAST_SALE                  String,
    DATE_LAST_PAID                  String,
    GENDER                          String,
    EMAILADDRESS                    String,
    COMPANY                         String,
    SHOP_NUMBER                     String,
    SPECIAL_INFORMATION             String,
    PRIOR_RECORD                    String,
    TAX_EXEMPT_REASCODE             String,
    BILLNAME                        String,
    BILLADDRESS                     String,
    BILLCITY                        String,
    BILLSTATE                       String,
    BILLZIPCODE                     String,
    BILLCOUNTRY                     String,
    CHAIN                           String,
    BILLPHONEAREA                   String,
    BILLPHONETHREE                  String,
    BILLPHONEFOUR                   String,
    BILLCONTACTNAME                 String,
    BILLCONTACTTITLE                String,
    FLEETPROXYFLAG                  String,
    FLEETCUSTOMERNUMBER             String,
    CREDIT_LIMIT_TYPE               String,
    CREDIT_LIMIT_PCT                String,
    PAYMENT_TERMS                   String,
    SEND_TO_SHOP                    String,
    WEB_CUSTOMER_ID                 String,
    REQUIRED_FIELD_1                String,
    REQUIRED_FIELD_2                String,
    LAST_STATEMENT_DATE             String,
    New_Update                      String,
    FRANCHISE_CUST_NBR              String,
    FIRST_INVOICE_DATE              String,
    BUYING_LEVEL                    String,
    RETREAD                         String,
    List_Price                      String,
    GTRACS_CUSTOMER                 String,
    PRINT_OPTION                    String,
    GY_BillTo_NA                    String,
    GY_BillTo_NonSig                String,
    FAX_AREA_CODE                   String,
    FAX_THREE                       String,
    FAX_FOUR                        String,
    FAX_EXTENSION                   String,
    NON_SIG                         String,
    LEVEL1TAX_EXEMPT_NUMBER         String,
    LEVEL2TAX_EXEMPT_NUMBER         String,
    LEVEL3TAX_EXEMPT_NUMBER         String,
    LEVEL4TAX_EXEMPT_NUMBER         String,
    LEVEL5TAX_EXEMPT_NUMBER         String,
    LEVEL6TAX_EXEMPT_NUMBER         String,
    LEVEL7TAX_EXEMPT_NUMBER         String,
    LEVEL8TAX_EXEMPT_NUMBER         String,
    LEVEL9TAX_EXEMPT_NUMBER         String,
    ISLEVEL1TAXABLE                 String,
    ISLEVEL2TAXABLE                 String,
    ISLEVEL3TAXABLE                 String,
    ISLEVEL4TAXABLE                 String,
    ISLEVEL5TAXABLE                 String,
    ISLEVEL6TAXABLE                 String,
    ISLEVEL7TAXABLE                 String,
    ISLEVEL8TAXABLE                 String,
    ISLEVEL9TAXABLE                 String,
    CREDIT_APP                      String,
    ARTERM_CODE                     String,
    DATE_OPENED                     String,
    SALESMAN                        String,
    COUNTRY                         String,
    LOCAL_TAX_EXEMPT                String,
    LEGAL_NAME                      String,
    SEND_TO_THIRDPARTY              String,
    Office_Customer                 String,
    GY_EXEMPT_IND                   String,
    GY_ShipTo_Nonsig                String,
    CELL_PHONE_CARRIER              String,
    Tax_Certificate                 String,
    DISALLOW_TAGALONGS              String,
    REQUIRES_BUYSIDE_PONUM          String,
    LABOR_RATE                      String,
    TaxDflt                         String,
    PriceClassID                    String,
    CreditRule                      String,
    POReqd                          String,
    TaxID                           String,
    ShipComplete                    String,
    SPCLPGM_CODE                    String,
    CustFillPriority                String,
    DefaultPaymentType              String,
    DefaultShipToID                 String,
    ADP_CUSTOMERID                  String,
    LASTUPDATEDATE                  String,
    CUSTID8                         String,
    PRICE_SET_NUMBER                String,
    CI_TYPE                         String,
    CI_CUSTID                       String,
    PRINT_TYPE                      String,
    DO_NOT_MAIL                     String,
    DO_NOT_EMAIL                    String,
    RETREAD_CUSTOMER_ID             String,
    ARREGION                        String,
    RETREAD_ORDERTYPE               String,
    RETREAD_NA_CUSTOMER_NUMBER      String,
    RETREAD_NA_LOCATION_CODE        String,
    Member_ID_Number                String,
    Member_ID_ExpDate               String,
    Coupon_Sales_YTD                String,
    New_Customer                    String,
    adw_lake_insert_datetime        datetime,
    adw_lake_insert_batch_number    int64 )
  PARTITION BY DATE(_PARTITIONTIME); 